[["iteration.html", "Iteration 0.1 Objective 0.2 Iteration Examples 0.3 Final Plot", " Iteration Up until this point, we have been able to download and map the range of one plant species at a time. However, what if we want to download the data for and create a range map of several plant species? This is where iteration comes into play! Essentially, iteration is a way of running the code you wrote in your function multiple times. So if you ever find yourself copy-pasting, then you could likely benefit from using iteration. There are three main ways to do iterations: For Loops Apply functions Map functions 0.1 Objective The goal of this mini-workshop is to map multiple Fraxinus species in one plot. In order to do this, I will need to download the data for each Fraxinus species, combine each respective dataset into one dataframe, and then can use this dataframe to plot the range of multiple species. 0.2 Iteration Examples First, I will need to write a function to download the data. # Let&#39;s create one datafame to start download_data &lt;- function(x){ GBIFdata = occ_search(scientificName = x, limit = 300, hasCoordinate = TRUE, basisOfRecord = &quot;PRESERVED_SPECIMEN&quot;) dat &lt;- GBIFdata$data return(dat) } # test df_FP &lt;- download_data(&quot;Fraxinus pallisiae&quot;) For Loops Now, let’s use this function to download data for other species of Fraxinus. The first method I’ll will use is For Loops, which essentially repeats the code you’ve written across different input values (i). For example, for(i in 1:10) { print(i) } We will need to create an empty dataframe to save the results of the loop results &lt;- rep(NA, 10) for(i in 1:10) { results[i] &lt;- i*10 } Now let’s try to translate this to the GBIF example. # Now let&#39;s try bringing in multiple species ## create list of all Fraxinus species species_names &lt;- read.csv(&quot;fraxinus_species.csv&quot;) %&gt;% #I scraped this list off the GBIF website dplyr::select(Name)%&gt;% as.list() species_names ## there&#39;s a lot so for time sake let&#39;s just select a few species species &lt;- c(&quot;Fraxinus albicans Buckley&quot;, &quot;Fraxinus americana&quot;, &quot;Fraxinus angustifolia&quot;, &quot;Fraxinus anomala&quot;, &quot;Fraxinus apertisquamifera&quot;) ### Let&#39;s just select columns of interest across datasets: colnames(df_FP) ### Columns we want: &quot;scientificName&quot;, &quot;decimalLatitude&quot;,&quot;decimalLongitude&quot; ## Function download_data &lt;- function(x){ GBIFdata &lt;- occ_search(scientificName = x, limit = 300, hasCoordinate = TRUE, basisOfRecord = &quot;PRESERVED_SPECIMEN&quot;) dat &lt;- GBIFdata$data dat &lt;- tryCatch( # this tells R to skip over any dataframes that did not have the columns of interest {dat %&gt;% filter(scientificName != &quot;NA&quot;) %&gt;% #get rid of species name with &quot;NA&quot; dplyr::select(scientificName, decimalLatitude, decimalLongitude)}, error=function(error_message) { message(&quot;Missing column.&quot;) message(&quot;And below is the error message from R:&quot;) message(error_message) return(NA)}) return(dat) } ## Run for loop again and see if it works comb_species &lt;- data.frame() for(i in species) { df &lt;- download_data(i) comb_species &lt;- bind_rows(comb_species, df) } Apply functions Another option for iteration are apply functions in base R. Check out this tutorial for more information: https://ademos.people.uic.edu/Chapter4.html. They often run faster than for loops &amp; can be a lot simpler to set up! ?apply # just the apply function requires a matrix or dataframe to loop over, but this isn&#39;t the format of our input value which is a list...let&#39;s look at other options! ?lapply ?sapply comb_species_apply &lt;- lapply(species, FUN = download_data) #spits out a list! # how to go from list to dataframe? # do.call calls the function you specify and runs it on the next argument comb_species_apply_df &lt;- do.call(&quot;bind_rows&quot;, comb_species_apply) #this will turn the list into a dataframe Map functions Apply functions are very handy, but for those dedicated to tidyverse you might be interested in the map family of functions from the purrr package (which is in the tidyverse suite of packages). Check out this tutorial for more: https://jennybc.github.io/purrr-tutorial/ ?purrr::map comb_species_map &lt;- purrr::map(species, .f = download_data) comb_species_map_df &lt;- do.call(&quot;bind_rows&quot;, comb_species_apply) 0.3 Final Plot Now let’s make a nice plot! wm = borders(&quot;world&quot;, colour=&quot;gray50&quot;, fill=&quot;gray50&quot;) #map backgroud ggplot2::ggplot()+ coord_fixed() + wm + geom_point(data = comb_species, aes(x = decimalLongitude, y = decimalLatitude, color = scientificName),size = 0.5) + theme_bw() + theme(legend.position = &quot;bottom&quot;) "],["404.html", "Page not found", " Page not found The page you requested cannot be found (perhaps it was moved or renamed). You may want to try searching to find the page's new location, or use the table of contents to find the page you are looking for. "]]
